# Checkout-at-end release checklist

Краткий чеклист перед релизом/выкаткой изменений платежного флоу.

## 1) Локальная проверка
1. Убедиться, что `.env` содержит минимум:
   - `BOT_TOKEN`
   - `DATABASE_URL`
2. Для платных сценариев проверить наличие хотя бы одного payment-конфига:
   - `PRODAMUS_FORM_URL` или `CLOUDPAYMENTS_PUBLIC_ID`
3. Запустить целевой smoke-check:
   ```bash
   bash scripts/smoke_check_checkout_flow.sh
   ```

## 2) Что должно быть подтверждено тестами
- Цена не показывается на ранних шагах (`S2`).
- Цена показывается только на финальном checkout (`S3`).
- Профиль (`S4`) и анкета (`S5` для T2/T3) доступны до оплаты.
- Для платных тарифов без `paid` генерация не стартует.
- После `paid` deep-link `paywait_<order_id>` ведёт в `S6/S7`.
- Restore waiter подхватывает только checkout-состояния (S3).

## 3) Post-deploy smoke
1. `T1: S1 -> S2 -> S4 -> S3 -> S6 -> S7`
2. `T2/T3: S1 -> S2 -> S4 -> S5 -> S3 -> S6 -> S7`
3. `T0` — совместимый бесплатный путь без оплаты.
4. Проверить deep-link:
   - unpaid `paywait_<order_id>` -> `S3`
   - paid `paywait_<order_id>` -> `S6/S7`

## 4) Failure-safe ожидания
- При отсутствующих платежных переменных бот не падает.
- Пользователь получает уведомление о недоступности ссылки оплаты.
- Флоу остаётся управляемым (можно вернуться к шагам и повторить).
