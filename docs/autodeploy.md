# Автодеплой (GitHub Actions)

Этот проект уже содержит workflow автодеплоя в `.github/workflows/deploy.yml`. Ниже — пошаговая инструкция по настройке.

## 1. Подготовить сервер

1. Создайте системного пользователя для деплоя (например, `deploy`).
2. Клонируйте репозиторий на сервер в каталог, который будет использоваться для деплоя:
   ```bash
   git clone <REPO_URL> /opt/numerolog_bot
   ```
3. Убедитесь, что сервис бота настроен как systemd‑юнит (пример: `numerolog-bot.service`).
4. Проверьте, что командой `systemctl restart <SERVICE_NAME>` сервис успешно перезапускается.

## 2. Настроить SSH‑доступ

1. Сгенерируйте SSH‑ключ (рекомендуется ED25519):
   ```bash
   ssh-keygen -t ed25519 -C "deploy@numerolog-bot"
   ```
2. Добавьте публичный ключ в `~/.ssh/authorized_keys` пользователя деплоя на сервере.

## 3. Добавить секреты в GitHub

Перейдите в **Settings → Secrets and variables → Actions** и добавьте секреты:

- `SSH_PRIVATE_KEY` — приватный ключ, который имеет доступ к серверу.
- `SSH_HOST` — домен или IP сервера.
- `SSH_PORT` — SSH‑порт (например, `22`).
- `SSH_USER` — пользователь деплоя (например, `deploy`).
- `DEPLOY_PATH` — путь к каталогу репозитория на сервере (например, `/opt/numerolog_bot`).
- `SERVICE_NAME` — имя systemd‑сервиса (например, `numerolog-bot`).

## 4. Проверить deploy workflow

1. Слейте изменения в `main` — деплой запустится автоматически.
2. Или запустите вручную в **Actions → Deploy to server** и выберите окружение.
3. Убедитесь, что в логе workflow нет ошибок.

## 5. Рекомендации

- Храните реальные API‑ключи в `.env` или секрет‑хранилище на сервере, а не в репозитории.
- Используйте отдельного пользователя и ограничьте его права только необходимыми.
- Добавьте мониторинг и уведомления об ошибках деплоя.
