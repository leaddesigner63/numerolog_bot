Ниже — полноценное техническое задание (ТЗ) на MVP Telegram-бота “ИИ-аналитик личных данных”, с учётом всей доработанной концепции и ваших дополнительных требований. Основание по тарифам/лексике/принципам — из вводных. 
Сбор инфы для концепции

Техническое задание (MVP)
Проект: Telegram-бот “ИИ-аналитик личных данных”
Канал: Telegram (приватный чат с ботом)
Монетизация MVP: разовые платежи за доступ к отчёту (T1–T3), T0 бесплатный с лимитом 1 раз в месяц
LLM: Gemini (основной), fallback на ChatGPT API при ошибках/исчерпании квоты
Платежи: Prodamus (основной), fallback CloudPayments
PDF: по кнопке “Выгрузить PDF” под готовым отчётом

1) Цели и рамки MVP
1.1. Цель MVP
Сделать работающий Telegram-бот, который:
показывает пользователю тарифы (T0–T3) и даёт выбрать любой тариф в любой момент;
принимает оплату (для платных тарифов) и генерирует отчёт только после подтверждения оплаты;
запрашивает “Мои данные” после выбора тарифа и оплаты (для T0 — после выбора, т.к. оплаты нет);
для T2/T3 дополнительно запрашивает короткую расширенную анкету (лайтовая);
выдаёт отчёт в чат + позволяет выгрузить его в PDF по кнопке;
содержит кнопку “Обратная связь” с публикацией сообщения в группе;
соблюдает контент-политику (запрещённые слова, отсутствие “предсказаний/гарантий”, красные зоны);
отображает “возвратов нет” и ссылку на оферту до оплаты.
1.2. Вне рамок MVP (не делаем сейчас)
рекуррентные подписки;
периодические уведомления;
продвинутый дизайн PDF (делаем базовый);
“админка” для ручного просмотра логов/версий отчётов (не требуется).

2) Термины, лексика и безопасность контента
2.1. Запрещённые слова и обещания
В тексте отчёта и интерфейсе запрещены:
“нумерология”, “предназначение”, “судьба”, “карма”, “прогноз”;
любые обещания результата, гарантии, “100%” и аналоги;
любые “натальные” термины и параметры в пользовательской части.
Разрешённые формулировки:
“личные предрасположенности”, “навыки и компетенции”, “интересы и мотивация”, “жизненный и профессиональный опыт”, “поведенческие паттерны”, “ценности”, “рабочие гипотезы”, “варианты сценариев”, “зоны роста”.
2.2. Красные зоны (отказ от обсуждения)
Бот не обсуждает и не генерирует:
медицину (болезни, диагнозы, лечение, лекарства, терапия);
финансы/инвестиции (что купить/продать, куда вложить, торговые сигналы);
азартные игры/ставки;
наркотики и инструкции;
экстремизм/насилие/противозаконные действия;
контент сексуального характера/порнографию;
самоповреждения/суицидальные инструкции.
Поведение бота при запросе из “красных зон”:
мягкий отказ + предложение вернуться к допустимой теме (“я могу помочь структурировать цели/опыт/варианты развития в рамках аналитического отчёта”).
2.3. Обязательные дисклеймеры
На экране оферты и в каждом отчёте:
“Сервис не является консультацией, прогнозом или рекомендацией к действию”
“Все выводы носят аналитический и описательный характер”
“Ответственность за решения остаётся за пользователем”
“Сервис не гарантирует финансовых или иных результатов”
“Возвратов нет” (см. раздел 9)

3) Тарифы и состав результатов
3.1. Общие принципы
Пользователь может выбрать любой тариф в любой момент (T0/T1/T2/T3).
Генерация отчёта только после подтверждения оплаты (для T1–T3).
Для T0 оплата отсутствует; генерация доступна, но ограничена лимитом 1 раз в месяц.
3.2. T0 (0 ₽) — “Как видит тебя ИИ-аналитик” (30%)
Вход: “Мои данные” (имя, дата, время, место рождения)
Выход (в чат):
структура полного отчёта (витрина);
кратко: базовый психо-профессиональный тип (описательно);
ключевые ориентиры по сферам;
“карта сильных сторон” и “зоны потенциального роста” (сжато);
2–3 предложения осторожной ретроспективы (“вероятно, вы уже проходили период…”), без “предсказаний”.
Ограничение: T0 можно запросить не чаще 1 раза в месяц (реализуем как cooldown в часах, задаётся в .env).
3.3. T1 (560 ₽) — 100% краткого отчёта
Вход: “Мои данные”
Выход: полный краткий отчёт (по структуре T0, но полностью).
3.4. T2 (2190 ₽) — “Краткий отчёт + аналитика анкеты (фокус: деньги)”
Вход: “Мои данные” + лайтовая расширенная анкета
Выход:
всё из T1;
позитивная аналитика на основе сопоставления данных анкеты и рассчитанных параметров профиля:
“какие ваши заявленные цели/опыт/интересы лучше всего поддерживаются наблюдаемыми паттернами и какие практичные траектории отсюда логично собрать” (без “совпало/не совпало”);
2–4 сценария развития:
почему логичен исходя из ответов,
какие навыки нужны,
формат дохода (без обещаний),
риски и ограничения,
способ проверки за 2–4 недели.
3.5. T3 (5930 ₽) — “План действий”
Вход: “Мои данные” + лайтовая расширенная анкета
Выход:
всё из T2;
план действий: 1 месяц (по неделям) + 1 год (помесячно) для выбранного направления;
бонус-разделы: энергия/отношения, без медицины (только “на что обратить внимание / вопросы к себе”, без диагнозов/лечения).

4) UX/Навигация: бот как “приложение с экранами”
4.1. Общий принцип “один экран”
В любой момент отображается один экран (один “контейнер” сообщений бота).
Навигация — только через inline-клавиатуру.
При переходе на новый экран бот делает “очистку диалога”: удаляет свои предыдущие сообщения экрана и показывает новый экран.
Ограничение Telegram: удаление сообщений ботом ограничено (например, сообщения старше ~48 часов могут не удаляться). 
Требование MVP: “очистка” означает удаление сообщений бота, насколько это возможно. Если сообщение удалить нельзя — бот:
либо редактирует (если подходит),
либо отправляет новый экран и визуально отделяет контент (но целимся на удаление).
4.2. Глобальное меню (inline)
Кнопки меню (присутствуют на большинстве экранов):
Тарифы
Мои данные (не “Заполнить данные”)
Оферта
Обратная связь
“Мои данные” в MVP фактически редактируются/вводятся в рамках flow после оплаты (см. ниже), но кнопку меню оставляем для просмотра текущих сохранённых данных (read-only) и/или перезаполнения по правилам.

5) Экранная модель (список экранов и переходов)
Ниже — минимально необходимый набор экранов.
5.1. Экран S0: Старт
Контент:
короткое описание сервиса (в разрешённой лексике),
дисклеймер (краткий),
кнопки: Тарифы, Оферта, Обратная связь.
5.2. Экран S1: Тарифы
Показывает 4 карточки/блока:
T0 — 0 ₽ (кнопка “Получить T0” / “Запросить бесплатный отчёт”)
T1 — 560 ₽ (кнопка “Выбрать T1”)
T2 — 2190 ₽ (кнопка “Выбрать T2”)
T3 — 5930 ₽ (кнопка “Выбрать T3”)
Важно: тариф можно выбрать в любой момент (даже если пользователь уже делал T0).
5.3. Экран S2: Оферта и правила (обязателен перед оплатой)
Контент:
краткие условия: что продукт делает/не делает, дисклеймеры,
отдельный заметный блок: “Возвратов нет”,
кнопка “Открыть оферту” (URL берём из OFFER_URL в .env),
кнопка “Назад к тарифам”.
5.4. Экран S3: Оплата (для T1–T3)
Контент:
выбранный тариф, сумма,
напоминание: “возвратов нет” + ссылка на оферту,
кнопка “Перейти к оплате” → открывает платёжную ссылку,
кнопка “Я оплатил(а)” (ручная) — не даёт генерацию, а инициирует проверку статуса (на случай задержки webhook).
5.5. Экран S4: Мои данные (ввод)
Требование: “Мои данные” запрашиваются после выбора и оплаты тарифа (для T1–T3).
Для T0: после выбора T0 (так как оплаты нет).
Поля:
Имя (строка)
Дата рождения (YYYY-MM-DD)
Время рождения (HH:MM, опционально? — если обязательно, фиксируем обязательно)
Место рождения: населённый пункт, регион, страна (строки)
UX: ввод по шагам (wizard), чтобы не перегружать.
Кнопки:
“Сохранить” (переход к следующему шагу: анкета для T2/T3 или генерация)
“Отмена” (возврат на Тарифы)
5.6. Экран S5: Расширенная анкета (только T2/T3)
Формат: лайтовая анкета — небольшой набор вопросов (утвердить в ТЗ-приложении, см. раздел 12).
Поддержать:
многошаговый ввод,
сохранение прогресса,
кнопка “Готово”.
5.7. Экран S6: Генерация отчёта (ожидание)
Контент:
“Генерируем отчёт…”
индикатор/статус
кнопка “Назад в Тарифы” (без отмены генерации — просто навигация)
5.8. Экран S7: Результат (отчёт)
Контент:
отчёт, разбитый на блоки/заголовки
обязательные дисклеймеры в конце
кнопки под отчётом:
“Выгрузить PDF”
“Тарифы”
“Обратная связь”
5.9. Экран S8: Обратная связь (публикация в группе)
Требование: при нажатии “Обратная связь” пользователь попадает на экран написания сообщения, с подсказкой + кнопки:
“Отправить” (сообщение публикуется в группе)
“Перейти в группу” (открывает ссылку на группу)
Интеграция варианты:
Вариант А: через @livegrambot (как вы указали) — бот перенаправляет/организует поток сообщений через livegrambot.
Вариант Б: нативно в продукте — наш бот отправляет сообщение в группу через sendMessage, если бот админ группы и знает FEEDBACK_GROUP_CHAT_ID.
MVP-реализация (рекомендуемая): Вариант Б (нативно) — меньше внешних зависимостей; Вариант А оставить как fallback/быстрый запуск.
(Выбор фиксируем в .env: FEEDBACK_MODE=livegram|native.)
Подсказка на экране:
“Напишите сообщение. Нажмите «Отправить», чтобы опубликовать его в группе, или «Перейти в группу».”

6) Платежи: Prodamus (основной) + CloudPayments (fallback)
6.1. Общий принцип платежей (важно)
Генерация отчёта допускается только после подтверждения оплаты (webhook или проверка статуса).
Любые “предгенерации” запрещены (экономия токенов).
6.2. Prodamus (основной)
По документации Prodamus, платёжная ссылка формируется запросом к платёжной странице (GET/POST) и используется уведомление (webhook) + секретный ключ. 
Требования реализации:
Создание “заказа” (order) у нас: order_id, user_id, tariff, amount, status=created.
Генерация платёжной ссылки:
формируем набор параметров платежа (сумма, описание, order_id, callback URLs),
генерируем URL оплаты и показываем пользователю.
Приём webhook от Prodamus:
проверка подписи/секретного ключа,
обновление status=paid,
фиксация paid_at, provider_payment_id,
переход в flow “Мои данные”.
Возвраты: не поддерживаем в продуктовой логике (см. оферту “возвратов нет”).
6.3. CloudPayments (fallback)
CloudPayments позволяет в Telegram-сценариях генерировать платёжную ссылку и получать подтверждение оплаты на стороне бота через уведомления. 
Условия переключения на fallback:
Prodamus не удалось подключить (нет ключей/ошибка интеграции) — включаем PAYMENT_PROVIDER=cloudpayments.
На уровне кода: абстракция PaymentProvider с методами create_payment_link() и verify_webhook().

7) LLM: Gemini primary → fallback ChatGPT
7.1. Маршрутизация запросов (Model Router)
Основной провайдер: Gemini
Fallback: ChatGPT API
Триггеры fallback:
HTTP 429 RESOURCE_EXHAUSTED (лимит/квота) — типовой кейс у Gemini. 
любые ошибки авторизации/квоты/истечения ключа (401/403/429),
сетевые/таймауты (5xx) — по политике retry, далее fallback.
Поведение:
попытка вызова Gemini,
при ошибке из списка — логируем событие (без ПДн),
переключаемся на ChatGPT API,
если и fallback недоступен — показываем экран “Сервис временно недоступен, попробуйте позже” (без генерации).
7.2. Политика повторов (retry)
Gemini: 1–2 быстрых retry на transient ошибки (500/503/timeout), затем fallback.
ChatGPT: 1 retry на transient.
Важно: не делать бесконечных циклов.
7.3. Подготовка входа в LLM (facts pack)
Чтобы снизить риски контента и упростить контроль:
в LLM передаётся структурированный facts-pack (JSON-структура), а не “сырые” анкеты без рамок;
в facts-pack не передавать “натальные” термины; только нейтральные: “рассчитанные параметры профиля”.

8) Генерация отчёта: шаблоны, фильтры, безопасность
8.1. Шаблоны отчётов (структура)
Единый каркас (T0/T1/T2/T3) с условными секциями по тарифу.
Блоки (минимум):
Как читать отчёт + дисклеймер
Резюме (5–7 пунктов)
Сильные стороны (текущие)
Зоны потенциального роста
Ориентиры по сферам
(T2/T3) Фокус на деньги: 2–4 сценария
(T3) План на 1 месяц + 1 год
(T3) Энергия/отношения, без медицины
Дисклеймеры + “возвратов нет” (кратко, ссылкой на оферту)
8.2. Фильтр запрещённых слов
После получения текста от LLM:
проверяем наличие запрещённых слов и “токсичных” паттернов (гарантии/100%/предсказания),
если найдено — выполняем автоматическую регенерацию с ужесточённым промптом (“исправь, убери запрещённые слова, соблюдай словарь…”),
максимум 2 регенерации, далее — “не удалось сгенерировать безопасный текст, попробуйте позже”.
8.3. Фильтр “красных зон”
если пользователь пытается получить совет из красной зоны (сообщением в свободной форме), бот отвечает готовым “safe-reply” и предлагает перейти к допустимым экранам.
если LLM “принёс” красную зону — post-filter режет и регенерирует.

9) Оферта, “возвратов нет”, ссылки
9.1. Явное сообщение “возвратов нет”
Требование: прямо прописать пользователю отсутствие возвратов.
Реализация:
экран “Оферта” (S2) содержит блок “Возвратов нет”.
экран “Оплата” (S3) повторяет “Возвратов нет”.
перед переходом к оплате — кнопка “Перейти к оплате” сопровождается текстом:
“Оплачивая, вы подтверждаете согласие с офертой. Возвратов нет.”
9.2. Ссылка на оферту
URL оферты хранится в .env как OFFER_URL.
В боте используется inline-кнопка открытия ссылки.
9.3. Создание оферты (контент для MVP)
Формат: отдельная веб-страница (лендинг/документ), доступная по OFFER_URL.
Обязательные разделы оферты (минимальный состав):
Термины и определения
Предмет оферты: “доступ к аналитическому отчёту ИИ” (не “расчёт/прогноз”)
Ограничения сервиса и дисклеймеры (не консультация, не прогноз, не гарантия)
Запретные темы (красные зоны)
Порядок оплаты, момент оказания услуги (оказана при предоставлении доступа к отчёту)
Возвраты: отсутствуют (прямо, отдельным пунктом)
Персональные данные: согласие, цели обработки, порядок удаления/отзыва согласия (если добавите)
Контакты (в т.ч. группа/обратная связь)
Реквизиты
Юр-вычитка обязательна, но MVP-скелет можно сделать по этому списку.

10) PDF: генерация по кнопке
10.1. Требования
PDF генерируется только по нажатию “Выгрузить PDF”.
В PDF попадает:
тот же текст, что в чате,
заголовки/разделы,
дисклеймеры.
10.2. Хранение PDF
Сохраняем pdf_file_id/URL в базе, чтобы пользователь мог повторно скачать без новой генерации (по желанию).
Кнопка “Выгрузить PDF”:
если PDF уже есть → отдать существующий,
если нет → сгенерировать и отдать.

11) Лимиты и анти-абьюз
11.1. T0 бесплатный 1 раз в месяц
В базе хранить last_free_t0_at (timestamp).
Проверка при попытке “Получить T0”:
если now - last_free_t0_at < FREE_T0_COOLDOWN_HOURS → показать экран:
“Бесплатный отчёт доступен раз в месяц. Следующий доступен: {дата}”.
иначе — разрешить.
11.2. Лимиты задаются в часах в .env
Вводим переменные:
FREE_T0_COOLDOWN_HOURS=720 (30 дней)
(опционально) PAID_REPORT_COOLDOWN_HOURS=0 (если захотите ограничивать платные)
(опционально) PDF_COOLDOWN_HOURS=0 (если захотите ограничивать PDF)

12) “Лайтовая” анкета T2/T3 (приложение к ТЗ)
В MVP нужно заложить движок анкеты, но сами вопросы вы хотите проработать отдельно. Поэтому фиксируем:
анкета хранится как конфиг (JSON) версионируемый (например questionnaire_v1.json);
движок поддерживает:
типы вопросов: текст, выбор, шкала 1–5,
обязательность,
переходы по логике (минимально),
сохранение прогресса.
Минимальные блоки (как каркас):
опыт (что делал/что получалось)
навыки (самооценка шкалами)
интересы/мотивация
ограничения (время/ресурсы)
цели (доход/стабильность/свобода)

13) Техническая архитектура (MVP)
13.1. Компоненты
Telegram Bot (UI/экраны/inline-клавиатура) — через Telegram Bot API
Backend API (основная логика)
DB (реляционная)
Storage для PDF (объектное)
Интеграции:
Prodamus / CloudPayments
Gemini / ChatGPT API
(опционально) livegrambot / нативная группа feedback
13.2. Рекомендуемый стек (можно менять)
Backend: Python + FastAPI (или Node.js + NestJS — на выбор команды)
Telegram: aiogram/pyTelegramBotAPI (или telegraf для Node)
DB: PostgreSQL
Очереди (опционально): Redis + очередь задач (если генерация тяжёлая)
PDF: wkhtmltopdf / WeasyPrint / Puppeteer (в зависимости от языка)

14) Хранение данных и модели (ERD на уровне сущностей)
14.1. Таблицы (минимум)
users
id (PK)
telegram_user_id (unique)
created_at, updated_at
user_profile
user_id (FK)
name
birth_date
birth_time
birth_place_city
birth_place_region
birth_place_country
updated_at
orders
id (PK)
user_id (FK)
tariff (enum: T0/T1/T2/T3)
amount
currency
provider (enum: prodamus/cloudpayments/none)
provider_payment_id (nullable)
status (created/pending/paid/failed/canceled)
created_at, paid_at
reports
id (PK)
user_id (FK)
order_id (FK, nullable for T0)
tariff
report_text (text)
created_at
pdf_storage_key (nullable)
model_used (gemini/chatgpt)
safety_flags (json: найдено/исправлено и т.п.)
free_limits
user_id (FK)
last_t0_at (timestamp)
feedback_messages (если native-mode)
id (PK)
user_id (FK)
text
status (sent/failed)
sent_at

15) Экранный движок и “очистка диалога”
15.1. Screen Manager
В коде реализовать абстракцию:
render_screen(screen_id, user_id, state) → возвращает:
текст(ы) сообщения,
inline-клавиатуру,
список message_ids, отправленных в рамках экрана.
Перед показом нового экрана:
достать список message_ids предыдущего экрана,
попытаться удалить (deleteMessage),
очистить список,
отправить новый экран.
Примечание: Telegram имеет ограничения на удаление сообщений (например, “can’t be deleted” после определённого времени). 
В таких случаях:
продолжаем навигацию без падения,
логируем “screen_cleanup_failed”.

16) Потоки (Sequence) — критичные сценарии
16.1. Получение платного отчёта (T1–T3)
S1 Тарифы → выбор T1/T2/T3
S2 Оферта → пользователь ознакомился → назад
S3 Оплата → “Перейти к оплате” → платёжная форма
Webhook “paid” → backend помечает order=paid
Бот переводит на S4 “Мои данные” (запрос)
(T2/T3) S5 анкета → “Готово”
S6 генерация → LLM → post-filters
S7 результат + кнопка PDF
Жёсткое правило: шаг 7 не стартует, пока order != paid.
16.2. Бесплатный T0
S1 → “Получить T0”
проверка cooldown:
если нельзя → экран “доступно через …”
если можно → S4 “Мои данные”
генерация (без оплаты) → S7 результат
обновить last_t0_at=now
16.3. PDF
из S7 нажать “Выгрузить PDF”
если pdf есть → отправить файл
иначе → сгенерировать → сохранить → отправить
16.4. Обратная связь (native)
S8 пользователь вводит текст → “Отправить”
backend отправляет сообщение в группу (FEEDBACK_GROUP_CHAT_ID)
подтверждение: “Сообщение отправлено”
кнопка “Перейти в группу”

17) Конфигурация и секреты (.env)
17.1. Жёсткое требование
Все секреты храним в .env вне рабочего каталога (например, в /etc/appname/.env, в секрет-хранилище или в переменных окружения CI/CD).
Не коммитим .env в репозиторий.
17.2. Пример .env (шаблон)
# Telegram
BOT_TOKEN=...
ADMIN_IDS=123,456
OFFER_URL=https://<ваш-домен>/offer
FEEDBACK_GROUP_CHAT_ID=-1001234567890
FEEDBACK_GROUP_URL=https://t.me/<group>
FEEDBACK_MODE=native  # native | livegram

# LLM
GEMINI_API_KEY=...
OPENAI_API_KEY=...
LLM_PRIMARY=gemini
LLM_FALLBACK=openai
LLM_TIMEOUT_SECONDS=35

# Payment
PAYMENT_PROVIDER=prodamus  # prodamus | cloudpayments
PRODAMUS_FORM_URL=https://<ваш-домен-prodamus>
PRODAMUS_SECRET=...
PRODAMUS_WEBHOOK_SECRET=...
CLOUDPAYMENTS_PUBLIC_ID=...
CLOUDPAYMENTS_API_SECRET=...
PAYMENT_WEBHOOK_URL=https://<ваш-backend>/webhooks/payments

# Limits (hours)
FREE_T0_COOLDOWN_HOURS=720

# Storage / DB
DATABASE_URL=postgresql://...
PDF_STORAGE_BUCKET=...
PDF_STORAGE_KEY=...

# App
ENV=prod
LOG_LEVEL=info

18) Логирование и мониторинг (без “ручной админки”)
Так как ручной просмотр кейсов не нужен:
логируем только технические события:
экранные переходы (screen_id),
статусы оплат,
ошибки LLM (без текста анкеты/ПДн),
факты fallback Gemini → ChatGPT,
попытки нарушить красные зоны (без хранения запроса целиком; максимум категория).
метрики доступности/ошибок (минимально).

19) Тестирование и критерии приёмки
19.1. Функциональные критерии
Пользователь может в любой момент открыть “Тарифы” и выбрать любой тариф.
После выбора платного тарифа:
бот показывает “Оферта/Возвратов нет” и ссылку,
генерирует платёжную ссылку,
не генерирует отчёт, пока не получит подтверждение оплаты.
“Мои данные” запрашиваются:
для T1–T3 — только после подтверждения оплаты,
для T0 — после выбора тарифа.
T0 доступен не чаще 1 раза в месяц (cooldown в часах из .env).
При ошибке Gemini (включая исчерпание лимита 429 RESOURCE_EXHAUSTED) запрос уходит в ChatGPT API. 
Кнопка “Выгрузить PDF” создаёт/отдаёт PDF.
“Обратная связь” открывает экран ввода сообщения с кнопками “Отправить” и “Перейти в группу”, сообщение публикуется в группе.
Отчёт не содержит запрещённых слов и не содержит гарантий/предсказаний; при попытке появления — срабатывает регенерация/фильтр.
19.2. Нефункциональные критерии
Генерация отчёта: разумное время ответа (цель: < 60–90 сек для большинства кейсов, зависит от LLM).
Безопасность: секреты не в коде, не в репозитории.
Надёжность: при падении LLM бот показывает корректное сообщение и не списывает повторно оплату.

20) Примечания по интеграциям (чтобы команда не застряла)
Prodamus: генерация платёжной ссылки + webhook с секретом описаны в их инструкции. 
CloudPayments: есть типовой сценарий “генерируем ссылку → получаем подтверждение → выдаём доступ”. 
Очистка экрана в Telegram опирается на deleteMessage и имеет ограничения. 

