# Автодеплой (GitHub Actions + SSH)

Ниже — пошаговая инструкция настройки автодеплоя через GitHub Actions с деплоем по SSH на ваш сервер.

## 1. Подготовьте сервер
1. Создайте пользователя для деплоя (без root), например `deployer`.
2. Создайте директорию для проекта, например `/var/www/numerolog_bot`.
3. Убедитесь, что на сервере установлены `git`, `python` и `bash`.
4. (Опционально) создайте systemd-сервис для бота/API.

## 2. Настройте SSH-доступ
1. Сгенерируйте SSH-ключ (или используйте существующий) для GitHub Actions:
   ```bash
   ssh-keygen -t ed25519 -C "github-actions-deploy"
   ```
2. Добавьте публичный ключ в `~/.ssh/authorized_keys` пользователя деплоя на сервере.

## 3. Создайте секреты в GitHub
В репозитории зайдите в **Settings → Secrets and variables → Actions** и добавьте:
- `DEPLOY_HOST` — IP/домен сервера.
- `DEPLOY_USER` — пользователь SSH (например, `deployer`).
- `DEPLOY_SSH_KEY` — приватный ключ (полное содержимое файла, включая строки `BEGIN/END`).
- `DEPLOY_PORT` — SSH-порт (обычно `22`).
- `DEPLOY_PATH` — путь к директории проекта на сервере (например, `/var/www/numerolog_bot`).
- `DEPLOY_SERVICE` — имя systemd-сервиса (если используете автоперезапуск).

## 4. Проверьте workflow
1. Откройте файл `.github/workflows/deploy.yml` и убедитесь, что ветка деплоя — `main`.
2. Сделайте коммит и пуш в `main`.
3. Проверьте запуск workflow во вкладке **Actions**.

## 5. Добавьте скрипт деплоя (опционально)
Если нужен дополнительный деплой (например, перезапуск сервисов), добавьте файл `scripts/deploy.sh`:
```bash
#!/usr/bin/env bash
set -euo pipefail
# Пример: systemctl restart your-service
```
Сделайте файл исполняемым:
```bash
chmod +x scripts/deploy.sh
```

## 6. Проверка
После пуша в `main` убедитесь, что репозиторий развернулся в директории `DEPLOY_PATH` и, при необходимости, перезапустились сервисы.
