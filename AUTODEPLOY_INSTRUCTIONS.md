# Автодеплой (GitHub Actions + SSH)

Ниже — пошаговая инструкция настройки автодеплоя через GitHub Actions с деплоем по SSH на ваш сервер.

## 1. Подготовьте сервер
1. Создайте пользователя для деплоя (без root), например `deployer`.
2. Создайте директорию для проекта, например `/var/www/numerolog_bot`.
3. Убедитесь, что на сервере установлены `git`, `python` и `bash`.
4. (Опционально) создайте systemd-сервис для бота/API.

## 2. Настройте SSH-доступ
1. Сгенерируйте SSH-ключ (или используйте существующий) для GitHub Actions:
   ```bash
   ssh-keygen -t ed25519 -C "github-actions-deploy"
   ```
2. Добавьте публичный ключ в `~/.ssh/authorized_keys` пользователя деплоя на сервере.

## 3. Создайте секреты в GitHub
В репозитории зайдите в **Settings → Secrets and variables → Actions** и добавьте **строго** следующие имена (они используются в workflow и менять `.github/workflows/deploy.yml` не нужно):
- `SSH_HOST` — IP/домен сервера.
- `SSH_USER` — пользователь SSH (например, `deployer`).
- `SSH_PRIVATE_KEY` — приватный ключ (полное содержимое файла, включая строки `BEGIN/END`).
- `SSH_PORT` — SSH-порт (обычно `22`).
- `DEPLOY_PATH` — путь к директории проекта на сервере (например, `/var/www/numerolog_bot`).
- `SERVICE_NAME` — имя systemd-сервиса (обязательно, т.к. workflow выполняет `systemctl restart`).

## 4. Проверьте workflow
1. Убедитесь, что **секреты с точными именами** из шага 3 добавлены в репозиторий.
2. Файл `.github/workflows/deploy.yml` уже настроен под эти секреты — **не редактируйте его**.
3. Сделайте коммит и пуш в `main`.
4. Проверьте запуск workflow во вкладке **Actions**.

## 5. Дополнительные команды деплоя (опционально)
Workflow уже делает `git reset` и `systemctl restart`. Если нужны дополнительные шаги (миграции, сборка, кеш), добавляйте их **на сервере** в systemd unit или в отдельный скрипт, который будет вызываться вручную при необходимости.

## 6. Проверка
После пуша в `main` убедитесь, что репозиторий развернулся в директории `DEPLOY_PATH` и, при необходимости, перезапустились сервисы.
